{"version":2,"kind":"Article","sha256":"9ef851bffdf6fc2da4b6f376a0c81d00f191384e4630741eb2d93501267f1f68","slug":"wpref.youtubedemo","location":"/wpref/YouTubeDemo.md","dependencies":[],"frontmatter":{"authors":[{"nameParsed":{"literal":"James Goudy","given":"James","family":"Goudy"},"name":"James Goudy","id":"contributors-a_books\\csci210_webprog\\wpbook\\myst-generated-uid-0"}],"copyright":"2024 By James Goudy","exports":[{"format":"md","filename":"YouTubeDemo.md","url":"CSCI210/build/YouTubeDemo-e7118cd4462f9c5abfee8b7c4e930c78.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"YouTube Demo","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w3DLjzCQon"}],"key":"aVzWXcYzRd"},{"type":"code","lang":"php","value":"<?php\n// Simple YouTube video manager using PDO (PHP Data Objects) and SQLite.\n// This script is a single-page app that can:\n// - Add YouTube videos with a title, genre, and description\n// - Store them in an SQLite database file\n// - Show one selected video in an embedded player\n// - List all saved videos and let you delete them\n\n// Enforce strict typing for function parameters and return types.\n// This helps catch some type-related mistakes early.\ndeclare(strict_types=1);\n\n// Build the path to the SQLite database file.\n// __DIR__ is the directory where this PHP file lives.\n$dbPath = __DIR__ . '/videos.sqlite';\n\n// The DSN (Data Source Name) tells PDO which database driver to use and where it is.\n// For SQLite, the format is \"sqlite:/path/to/file\".\n$dsn = 'sqlite:' . $dbPath;\n\ntry {\n    // Create a new PDO connection to the SQLite database.\n    $pdo = new PDO($dsn);\n\n    // Tell PDO to throw exceptions when errors happen.\n    // This makes error handling easier.\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (PDOException $e) {\n    // If anything goes wrong with the connection, stop the script\n    // and show a safe error message.\n    die('Database connection failed: ' . htmlspecialchars($e->getMessage()));\n}\n\n// Create the \"videos\" table if it does not already exist.\n// This is a simple schema for our video manager.\n$pdo->exec(\n    'CREATE TABLE IF NOT EXISTS videos (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,  -- Unique ID for each video\n        title TEXT NOT NULL,                   -- Video title\n        url TEXT NOT NULL,                     -- Original YouTube URL\n        video_id TEXT NOT NULL,                -- Extracted YouTube video ID\n        genre TEXT NOT NULL,                   -- Category/genre\n        description TEXT NOT NULL,             -- Description written by the user\n        created_at TEXT NOT NULL               -- When the entry was created (ISO timestamp)\n    )'\n);\n\n// This will hold feedback messages for the user (success or error).\n$message = '';\n\n/**\n * Extract the 11-character YouTube video ID from a URL.\n *\n * This function supports several common YouTube URL formats:\n *  - https://youtu.be/VIDEO_ID\n *  - https://www.youtube.com/watch?v=VIDEO_ID\n *  - https://www.youtube.com/embed/VIDEO_ID\n *  - https://www.youtube.com/shorts/VIDEO_ID\n *\n * If it can't find a valid ID, it returns null.\n */\nfunction extractYouTubeId(string $url): ?string\n{\n    // Regular expressions to match different YouTube URL patterns.\n    $patterns = [\n        '#youtu\\\\.be/([\\\\w-]{11})#i',\n        '#youtube\\\\.com/watch\\\\?v=([\\\\w-]{11})#i',\n        '#youtube\\\\.com/embed/([\\\\w-]{11})#i',\n        '#youtube\\\\.com/shorts/([\\\\w-]{11})#i',\n    ];\n\n    // Try each pattern until one matches.\n    foreach ($patterns as $pattern) {\n        if (preg_match($pattern, $url, $matches)) {\n            // $matches[1] contains the captured video ID.\n            return $matches[1];\n        }\n    }\n\n    // If we get here, none of the simple patterns matched.\n    // As a fallback, look at the query string (e.g., ?v=VIDEO_ID&t=123).\n    $parts = parse_url($url);\n    if (!empty($parts['query'])) {\n        // Turn \"key=value&key2=value2\" into an associative array.\n        parse_str($parts['query'], $query);\n        // Check for a \"v\" parameter that looks like a valid video ID.\n        if (!empty($query['v']) && preg_match('#^[\\\\w-]{11}$#', $query['v'])) {\n            return $query['v'];\n        }\n    }\n\n    // If no valid ID was found, return null.\n    return null;\n}\n\n// Handle form submissions (POST requests).\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // \"action\" tells us what the user wants to do (add or delete).\n    $action = $_POST['action'] ?? '';\n\n    // Handle adding a new video.\n    if ($action === 'add') {\n        // Read and trim form inputs (remove extra spaces).\n        $title = trim($_POST['title'] ?? '');\n        $url = trim($_POST['url'] ?? '');\n        $genre = trim($_POST['genre'] ?? '');\n        $description = trim($_POST['description'] ?? '');\n\n        // Basic validation: all fields are required.\n        if ($title === '' || $url === '' || $genre === '' || $description === '') {\n            $message = 'All fields are required.';\n        } else {\n            // Try to extract the YouTube video ID from the given URL.\n            $videoId = extractYouTubeId($url);\n\n            if ($videoId === null) {\n                // If the URL doesn't look like a valid YouTube link.\n                $message = 'Unable to determine YouTube video ID from the provided link.';\n            } else {\n                // Prepare an INSERT statement using named placeholders.\n                // This helps prevent SQL injection and keeps code clean.\n                $stmt = $pdo->prepare(\n                    'INSERT INTO videos (title, url, video_id, genre, description, created_at)\n                     VALUES (:title, :url, :video_id, :genre, :description, :created_at)'\n                );\n\n                // Execute the prepared statement with actual values.\n                $stmt->execute([\n                    ':title' => $title,\n                    ':url' => $url,\n                    ':video_id' => $videoId,\n                    ':genre' => $genre,\n                    ':description' => $description,\n                    // Store the current time in a standard format (ISO 8601).\n                    ':created_at' => (new DateTimeImmutable())->format(DateTimeInterface::ATOM),\n                ]);\n\n                $message = 'Video added successfully!';\n            }\n        }\n    }\n    // Handle deleting a video.\n    elseif ($action === 'delete') {\n        // Read the video ID from the form and cast it to an integer.\n        $id = isset($_POST['id']) ? (int) $_POST['id'] : 0;\n\n        if ($id > 0) {\n            // Use a prepared statement to safely delete the row.\n            $stmt = $pdo->prepare('DELETE FROM videos WHERE id = :id');\n            $stmt->execute([':id' => $id]);\n            $message = 'Video deleted.';\n        }\n    }\n}\n\n// Fetch all videos from the database, newest first.\n$videosStmt = $pdo->query('SELECT * FROM videos ORDER BY created_at DESC');\n\n// fetchAll(PDO::FETCH_ASSOC) returns an array of associative arrays.\n$videos = $videosStmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Determine which video should be shown in the player.\n// If the URL has ?watch=ID, use that. Otherwise, use the first video.\n$selectedId = isset($_GET['watch']) ? (int) $_GET['watch'] : null;\n$selectedVideo = null;\n\n// Look through the list to find the selected video by ID.\nif ($selectedId !== null) {\n    foreach ($videos as $video) {\n        if ((int) $video['id'] === $selectedId) {\n            $selectedVideo = $video;\n            break;\n        }\n    }\n}\n\n// If nothing is selected but there are videos, use the first one.\nif ($selectedVideo === null && !empty($videos)) {\n    $selectedVideo = $videos[0];\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <!-- Make the page responsive on phones and tablets -->\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>YouTube Video Manager</title>\n    <style>\n        /* Basic page styling using CSS */\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 0;\n            background: #f3f4f6;\n            color: #1f2933;\n        }\n        header {\n            background: #1a73e8;\n            color: white;\n            padding: 1rem 2rem;\n        }\n        main {\n            padding: 2rem;\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        .section {\n            background: white;\n            border-radius: 8px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        }\n        form .field {\n            display: flex;\n            flex-direction: column;\n            margin-bottom: 1rem;\n        }\n        form label {\n            font-weight: bold;\n            margin-bottom: 0.5rem;\n        }\n        form input[type=\"text\"],\n        form textarea {\n            padding: 0.75rem;\n            border: 1px solid #cbd5e1;\n            border-radius: 4px;\n            font-size: 1rem;\n        }\n        form textarea {\n            resize: vertical;\n            min-height: 100px;\n        }\n        form button {\n            background: #1a73e8;\n            color: white;\n            border: none;\n            padding: 0.75rem 1.5rem;\n            font-size: 1rem;\n            border-radius: 4px;\n            cursor: pointer;\n            transition: background 0.2s ease-in-out;\n        }\n        form button:hover {\n            background: #1558b0;\n        }\n        .message {\n            margin-bottom: 1rem;\n            color: #0f5132;\n        }\n        .video-player iframe {\n            width: 100%;\n            height: 420px;\n            border: none;\n            border-radius: 8px;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        th, td {\n            padding: 0.75rem;\n            border-bottom: 1px solid #e2e8f0;\n            text-align: left;\n            vertical-align: top;\n        }\n        th {\n            background: #f8fafc;\n        }\n        .actions {\n            display: flex;\n            gap: 0.5rem;\n        }\n        .actions a,\n        .actions button {\n            padding: 0.5rem 1rem;\n            border-radius: 4px;\n            text-decoration: none;\n            font-size: 0.9rem;\n        }\n        .play-button {\n            background: #22c55e;\n            color: white;\n        }\n        .play-button:hover {\n            background: #16a34a;\n        }\n        .delete-button {\n            background: #ef4444;\n            color: white;\n            border: none;\n            cursor: pointer;\n        }\n        .delete-button:hover {\n            background: #dc2626;\n        }\n        .description {\n            white-space: pre-wrap; /* Preserve line breaks in descriptions */\n        }\n        @media (max-width: 768px) {\n            .actions {\n                flex-direction: column;\n            }\n        }\n    </style>\n</head>\n<body>\n<header>\n    <h1>YouTube Video Manager</h1>\n</header>\n<main>\n    <!-- Section: Form to add a new video -->\n    <section class=\"section\">\n        <h2>Add a New Video</h2>\n\n        <!-- Show any success or error message to the user -->\n        <?php if ($message !== ''): ?>\n            <p class=\"message\">\n                <?php echo htmlspecialchars($message, ENT_QUOTES, 'UTF-8'); ?>\n            </p>\n        <?php endif; ?>\n\n        <!-- \"Add video\" form -->\n        <form method=\"post\">\n            <!-- Hidden field tells PHP that this form is for \"add\" action -->\n            <input type=\"hidden\" name=\"action\" value=\"add\">\n\n            <div class=\"field\">\n                <label for=\"title\">Title</label>\n                <input type=\"text\" id=\"title\" name=\"title\" required>\n            </div>\n\n            <div class=\"field\">\n                <label for=\"url\">YouTube Link</label>\n                <input type=\"text\" id=\"url\" name=\"url\" required>\n            </div>\n\n            <div class=\"field\">\n                <label for=\"genre\">Genre</label>\n                <input type=\"text\" id=\"genre\" name=\"genre\" required>\n            </div>\n\n            <div class=\"field\">\n                <label for=\"description\">Description</label>\n                <textarea id=\"description\" name=\"description\" required></textarea>\n            </div>\n\n            <button type=\"submit\">Add Video</button>\n        </form>\n    </section>\n\n    <!-- Section: Selected video player -->\n    <section class=\"section video-player\">\n        <h2>Selected Video</h2>\n\n        <?php if ($selectedVideo): ?>\n            <!-- Show the selected video's title -->\n            <h3>\n                <?php echo htmlspecialchars($selectedVideo['title'], ENT_QUOTES, 'UTF-8'); ?>\n            </h3>\n\n            <!-- Embed the YouTube video using the extracted video_id -->\n            <iframe\n                src=\"https://www.youtube.com/embed/<?php echo htmlspecialchars($selectedVideo['video_id'], ENT_QUOTES, 'UTF-8'); ?>\"\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                allowfullscreen>\n            </iframe>\n\n            <!-- Show the genre and description -->\n            <p>\n                <strong>Genre:</strong>\n                <?php echo htmlspecialchars($selectedVideo['genre'], ENT_QUOTES, 'UTF-8'); ?>\n            </p>\n            <p class=\"description\">\n                <?php\n                // nl2br() converts line breaks to <br> tags for better formatting.\n                echo nl2br(htmlspecialchars($selectedVideo['description'], ENT_QUOTES, 'UTF-8'));\n                ?>\n            </p>\n        <?php else: ?>\n            <!-- When no videos exist yet -->\n            <p>No videos available yet. Add one above to get started!</p>\n        <?php endif; ?>\n    </section>\n\n    <!-- Section: Table listing all videos -->\n    <section class=\"section\">\n        <h2>All Videos</h2>\n\n        <?php if (empty($videos)): ?>\n            <p>No videos saved.</p>\n        <?php else: ?>\n            <table>\n                <thead>\n                <tr>\n                    <th>Title</th>\n                    <th>Genre</th>\n                    <th>Description</th>\n                    <th>Link</th>\n                    <th>Actions</th>\n                </tr>\n                </thead>\n                <tbody>\n                <!-- Loop through all videos and show each in a table row -->\n                <?php foreach ($videos as $video): ?>\n                    <tr>\n                        <td>\n                            <?php echo htmlspecialchars($video['title'], ENT_QUOTES, 'UTF-8'); ?>\n                        </td>\n                        <td>\n                            <?php echo htmlspecialchars($video['genre'], ENT_QUOTES, 'UTF-8'); ?>\n                        </td>\n                        <td class=\"description\">\n                            <?php echo nl2br(htmlspecialchars($video['description'], ENT_QUOTES, 'UTF-8')); ?>\n                        </td>\n                        <td>\n                            <!-- Link to the original YouTube URL in a new tab -->\n                            <a href=\"<?php echo htmlspecialchars($video['url'], ENT_QUOTES, 'UTF-8'); ?>\"\n                               target=\"_blank\" rel=\"noopener noreferrer\">\n                                Open\n                            </a>\n                        </td>\n                        <td>\n                            <div class=\"actions\">\n                                <!-- \"Play\" button just reloads the page with ?watch=ID -->\n                                <a class=\"play-button\"\n                                   href=\"?watch=<?php echo (int) $video['id']; ?>\">\n                                    Play\n                                </a>\n\n                                <!-- \"Delete\" form for this specific video -->\n                                <form method=\"post\"\n                                      onsubmit=\"return confirm('Are you sure you want to delete this video?');\">\n                                    <input type=\"hidden\" name=\"action\" value=\"delete\">\n                                    <input type=\"hidden\" name=\"id\"\n                                           value=\"<?php echo (int) $video['id']; ?>\">\n                                    <button type=\"submit\" class=\"delete-button\">\n                                        Delete\n                                    </button>\n                                </form>\n                            </div>\n                        </td>\n                    </tr>\n                <?php endforeach; ?>\n                </tbody>\n            </table>\n        <?php endif; ?>\n    </section>\n</main>\n</body>\n</html>\n","position":{"start":{"line":3,"column":1},"end":{"line":458,"column":1}},"key":"rQ4jyk6Cah"}],"key":"DUwOu1J1rz"}],"key":"KZF0V8jAhF"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Search Filter - SQLITE","url":"/wpref/searchfiltersqlite","group":"Web Programming"}}},"domain":"http://localhost:3001"}