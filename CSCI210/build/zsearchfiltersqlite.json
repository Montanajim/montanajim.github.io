{"version":2,"kind":"Article","sha256":"605bc0625bb9d5cab7337abb1db807c2dd7d75ed52e257d11f0e849345bb2d45","slug":"zsearchfiltersqlite","location":"/zSearchFilterSQLITE.md","dependencies":[],"frontmatter":{"title":"Search Filter - SQLITE","content_includes_title":false,"authors":[{"nameParsed":{"literal":"James Goudy","given":"James","family":"Goudy"},"name":"James Goudy","id":"contributors-a_books\\csci210_webprog\\wpbook\\myst-generated-uid-0"}],"github":"https://github.com/montanajim/CSCI210","copyright":"2025 By James Goudy","numbering":{"title":{"offset":1}},"exports":[{"format":"md","filename":"zSearchFilterSQLITE.md","url":"/CSCI210//build/zSearchFilterSQLITE-4532048dfc44ba95b732ffafd4330ab0.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"code","lang":"php","value":"<?php\ndeclare(strict_types=1);\n\n$dbPath = __DIR__ . \"/database.sqlite\";\n$pdo = new PDO(\"sqlite:\" . $dbPath);\n$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n// Create table if it doesn't exist\n$pdo->exec(\"\n    CREATE TABLE IF NOT EXISTS students (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        major TEXT NOT NULL,\n        created_at TEXT NOT NULL\n    )\n\");\n\n\n// HANDLE FORM ACTIONS\n// -----------------------------\n\n// ADD new student\nif (isset($_POST['add'])) {\n    $name  = trim($_POST['name'] ?? '');\n    $major = trim($_POST['major'] ?? '');\n\n    if ($name !== '' && $major !== '') {\n        $stmt = $pdo->prepare(\"\n            INSERT INTO students (name, major, created_at)\n            VALUES (:n, :m, :c)\n        \");\n        $stmt->execute([\n            ':n' => $name,\n            ':m' => $major,\n            ':c' => date('Y-m-d H:i:s'),\n        ]);\n    }\n}\n\n// UPDATE existing student\nif (isset($_POST['update'])) {\n    $id    = (int)($_POST['id'] ?? 0);\n    $name  = trim($_POST['edit_name'] ?? '');\n    $major = trim($_POST['edit_major'] ?? '');\n\n    if ($id > 0 && $name !== '' && $major !== '') {\n        $stmt = $pdo->prepare(\"\n            UPDATE students\n            SET name = :n, major = :m\n            WHERE id = :id\n        \");\n        $stmt->execute([\n            ':n'  => $name,\n            ':m'  => $major,\n            ':id' => $id,\n        ]);\n    }\n}\n\n// DELETE student\nif (isset($_POST['delete'])) {\n    $id = (int)($_POST['id'] ?? 0);\n    if ($id > 0) {\n        $stmt = $pdo->prepare(\"DELETE FROM students WHERE id = :id\");\n        $stmt->execute([':id' => $id]);\n    }\n}\n\n\n// SEARCH FILTER\n// -----------------------------\n\n$searchTerm = trim($_GET['q'] ?? '');\n\n// If there is a search term, filter by name OR major\nif ($searchTerm !== '') {\n    $stmt = $pdo->prepare(\"\n        SELECT * FROM students\n        WHERE name  LIKE :q\n           OR major LIKE :q\n        ORDER BY id DESC\n    \");\n    $stmt->execute([':q' => '%' . $searchTerm . '%']);\n    $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\n} else {\n    // No search term: show all\n    // $rows = $pdo->query(\"\n    //     SELECT * FROM students\n    //     ORDER BY id DESC\n    // \")->fetchAll(PDO::FETCH_ASSOC);\n\n    $sqlstmt = \"SELECT * FROM students ORDER BY name\";\n    $stmt = $pdo->query($sqlstmt);\n    $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>SQLite + PHP CRUD Demo</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }\n        form { margin-bottom: 15px; }\n        .student-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }\n        .inline-form { display: inline-block; margin-right: 10px; }\n        input[type=\"text\"] { padding: 4px; margin-right: 4px; }\n        button { padding: 4px 8px; }\n    </style>\n</head>\n<body>\n    <h2>SQLite + PHP CRUD Demo</h2>\n\n    <!-- SEARCH FORM (GET) -->\n    <h3>Search Students</h3>\n    <form method=\"GET\">\n        <input\n            type=\"text\"\n            name=\"q\"\n            placeholder=\"Search by name or major\"\n            value=\"<?= htmlspecialchars($searchTerm) ?>\"\n        >\n        <button type=\"submit\">Search</button>\n        <a href=\"search_filter.php\"><button type=\"button\">Clear</button></a>\n    </form>\n\n    <!-- ADD FORM -->\n    <h3>Add New Student</h3>\n    <form method=\"POST\">\n        <input type=\"text\" name=\"name\" placeholder=\"Student Name\" required>\n        <input type=\"text\" name=\"major\" placeholder=\"Major\" required>\n        <button type=\"submit\" name=\"add\">Add Student</button>\n    </form>\n\n    <!-- STUDENT LIST -->\n    <h3>Students</h3>\n\n    <?php if (empty($rows)): ?>\n        <p><em>No students found.</em></p>\n    <?php else: ?>\n        <?php foreach ($rows as $r): ?>\n            <div class=\"student-card\">\n                <p>\n                    <strong>ID:</strong> <?= $r['id'] ?><br>\n                    <strong>Name:</strong> <?= htmlspecialchars($r['name']) ?><br>\n                    <strong>Major:</strong> <?= htmlspecialchars($r['major']) ?><br>\n                    <small>Created at: <?= htmlspecialchars($r['created_at']) ?></small>\n                </p>\n\n                <!-- UPDATE FORM (inline) -->\n                <form method=\"POST\" class=\"inline-form\">\n                    <input type=\"hidden\" name=\"id\" value=\"<?= $r['id'] ?>\">\n                    <input\n                        type=\"text\"\n                        name=\"edit_name\"\n                        value=\"<?= htmlspecialchars($r['name']) ?>\"\n                        placeholder=\"Name\"\n                        required\n                    >\n                    <input\n                        type=\"text\"\n                        name=\"edit_major\"\n                        value=\"<?= htmlspecialchars($r['major']) ?>\"\n                        placeholder=\"Major\"\n                        required\n                    >\n                    <button type=\"submit\" name=\"update\">Update</button>\n                </form>\n\n                <!-- DELETE FORM -->\n                <form method=\"POST\" class=\"inline-form\">\n                    <input type=\"hidden\" name=\"id\" value=\"<?= $r['id'] ?>\">\n                    <button type=\"submit\" name=\"delete\" onclick=\"return confirm('Delete this student?');\">\n                        Delete\n                    </button>\n                </form>\n            </div>\n        <?php endforeach; ?>\n    <?php endif; ?>\n</body>\n</html>\n","position":{"start":{"line":3,"column":1},"end":{"line":186,"column":1}},"key":"XxNhkoaiKR"}],"key":"bojH57a52g"}],"key":"KQwKSvBODc"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"PHP + SQLite Shortcut Guide","url":"/zsqliteguide","group":"Web Programming"},"next":{"title":"Z You Tube Demo","url":"/zyoutubedemo","group":"Web Programming"}}},"domain":"http://localhost:3004"}