
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>XSS Examples &#8212; Web Programming</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wpref/xssExamples';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Content Security Policy" href="xssContentSecurityPolicy.html" />
    <link rel="prev" title="Defending Against Cross Site Scripting" href="xssDefendingAgainstXSS.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Web Programming</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    CSCI 210 Web Programming
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="PHPIntroduction.html">PHP Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHPBasics.html">PHP Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="LoopIf.html">Loops and If</a></li>
<li class="toctree-l1"><a class="reference internal" href="phparrays.html">PHP Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="Functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="FirstFormsPOSTandGET.html">First Forms - POST and GET</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTMLInputFieldReview.html">HTML Input Field Review</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="SessionVariables.html">Session Variables</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="SessionHomeworkHint.html">Session Variable Homework Assignment Hint</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="PDOConnections.html">PDO Connections</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PHPClosingTags.html">PHP Closing Tags: Leave Them Out Or Out</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="PDOFirstDataDBInsertCarExample.html">PDO - First Data Insert - Car Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="PDONoPlaceHoldersExample.html">PDO With No Named Placeholders</a></li>
<li class="toctree-l2"><a class="reference internal" href="StringSanitation.html">String Sanitation - filter_var()</a></li>

</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="xssDefendingAgainstXSS.html">Defending Against Cross Site Scripting</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">XSS Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="xssContentSecurityPolicy.html">Content Security Policy</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="Passwords.html">Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="AddEditDelete.html">Add Edit Delete</a></li>
<li class="toctree-l1"><a class="reference internal" href="SavingPicturesInDatabase.html">Saving Pictures In Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="Readingjson.html">Reading json</a></li>
<li class="toctree-l1"><a class="reference internal" href="DateFunctionPHP.html">Date Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="zSearchFilterSQLITE.html">Search Filter - SQLITE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/wpref/xssExamples.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>XSS Examples</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#index-php-home-page-with-demo-links"><code class="docutils literal notranslate"><span class="pre">index.php</span></code> — home page with demo links</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page1-reflect-php-vulnerable-reflected-xss-don-t-use-in-production"><code class="docutils literal notranslate"><span class="pre">page1_reflect.php</span></code> — <strong>vulnerable</strong> reflected XSS (don’t use in production)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page1-reflect-prevent-php-reflected-xss-fixed"><code class="docutils literal notranslate"><span class="pre">page1_reflect_prevent.php</span></code> — reflected XSS <strong>fixed</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stored-hacked-php-vulnerable-stored-xss-guestbook"><code class="docutils literal notranslate"><span class="pre">stored_hacked.php</span></code> — <strong>vulnerable</strong> stored XSS guestbook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stored-hacked-prevent-php-stored-xss-prevented-sanitizing-on-output"><code class="docutils literal notranslate"><span class="pre">stored_hacked_prevent.php</span></code> — stored XSS <strong>prevented</strong> (sanitizing on output)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">10/2025</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="xss-examples">
<h1>XSS Examples<a class="headerlink" href="#xss-examples" title="Link to this heading">#</a></h1>
<p>This short chapter demonstrates two common XSS scenarios and how to fix them:</p>
<ol class="arabic simple">
<li><p><strong>Reflected XSS</strong> — user input (from the query string) is immediately written back into the page. The vulnerable example prints the raw query value; the fixed example escapes it with <code class="docutils literal notranslate"><span class="pre">htmlspecialchars</span></code> so any injected <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> becomes harmless text.</p></li>
<li><p><strong>Stored XSS (toy guestbook)</strong> — a user-submitted message is stored in session and later rendered for all visitors. The vulnerable example renders the raw stored value, which will execute in the browser. The fixed example sanitizes stored values on output using a small <code class="docutils literal notranslate"><span class="pre">sanitize()</span></code> helper that performs <code class="docutils literal notranslate"><span class="pre">trim()</span></code>, <code class="docutils literal notranslate"><span class="pre">strip_tags()</span></code> and <code class="docutils literal notranslate"><span class="pre">htmlspecialchars()</span></code> (ENT_QUOTES, UTF-8).</p></li>
</ol>
<p>Read the inline comments — I call out the vulnerable lines and explain the remediation. Use these pages in a classroom or lab to safely demonstrate how an attacker’s <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> turns into harmless text once properly escaped.</p>
<hr class="docutils" />
<section id="index-php-home-page-with-demo-links">
<h2><code class="docutils literal notranslate"><span class="pre">index.php</span></code> — home page with demo links<a class="headerlink" href="#index-php-home-page-with-demo-links" title="Link to this heading">#</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="c1">// Simple landing page linking to the vulnerable and fixed demo pages.</span>
<span class="c1">//</span>
<span class="c1">// This file is purely HTML. Links include an example exploit payload to</span>
<span class="c1">// illustrate how a reflected XSS payload would look in the query string.</span>
<span class="cp">?&gt;</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span>
<span class="x">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot; /&gt;</span>
<span class="x">    &lt;title&gt;XSS Home Demo&lt;/title&gt;</span>
<span class="x">    &lt;style&gt;</span>
<span class="x">        .div1 {</span>
<span class="x">            width: 50%;</span>
<span class="x">            background-color: cornsilk;</span>
<span class="x">            margin: 50px auto 0 auto;</span>
<span class="x">            padding: 1rem;</span>
<span class="x">            border-radius: 6px;</span>
<span class="x">            font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial;</span>
<span class="x">        }</span>
<span class="x">        a { display:block; margin:8px 0; }</span>
<span class="x">    &lt;/style&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class=&quot;div1&quot;&gt;</span>
<span class="x">        &lt;h1&gt;XSS Demos&lt;/h1&gt;</span>

<span class="x">        &lt;!--</span>
<span class="x">          The query string contains a classic demo payload:</span>
<span class="x">          ?q=&lt;script&gt;alert(&#39;Hacked&#39;)&lt;/script&gt;</span>
<span class="x">        --&gt;</span>
<span class="x">        &lt;a href=&quot;page1_reflect.php?q=&lt;script&gt;alert(&#39;Hacked&#39;)&lt;/script&gt;&quot;&gt;</span>
<span class="x">            Page 1 — Reflect (VULNERABLE)</span>
<span class="x">        &lt;/a&gt;</span>

<span class="x">        &lt;a href=&quot;page1_reflect_prevent.php?q=&lt;script&gt;alert(&#39;Hacked&#39;)&lt;/script&gt;&quot;&gt;</span>
<span class="x">            Page 1 — Reflect (Prevented)</span>
<span class="x">        &lt;/a&gt;</span>

<span class="x">        &lt;a href=&quot;stored_hacked.php&quot;&gt;Stored — Guestbook (VULNERABLE)&lt;/a&gt;</span>
<span class="x">        &lt;a href=&quot;stored_hacked_prevent.php&quot;&gt;Stored — Guestbook (Prevented)&lt;/a&gt;</span>

<span class="x">        &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="page1-reflect-php-vulnerable-reflected-xss-don-t-use-in-production">
<h2><code class="docutils literal notranslate"><span class="pre">page1_reflect.php</span></code> — <strong>vulnerable</strong> reflected XSS (don’t use in production)<a class="headerlink" href="#page1-reflect-php-vulnerable-reflected-xss-don-t-use-in-production" title="Link to this heading">#</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// page1_reflect.php</span>
<span class="c1">// Demonstrates reflected XSS by echoing a query parameter directly.</span>
<span class="c1">// *** VULNERABLE: the raw $q value is injected into the HTML output. ***</span>

<span class="c1">// Use null coalescing so page still works without ?q= in the URL.</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="cp">?&gt;</span>
<span class="x">&lt;!doctype html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="x">    &lt;title&gt;Hacked (Reflect - Vulnerable)&lt;/title&gt;</span>
<span class="x">    &lt;style&gt;</span>
<span class="x">        .div1 { width:50%; background:cornsilk; margin:50px auto; padding:1rem; }</span>
<span class="x">    &lt;/style&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class=&quot;div1&quot;&gt;</span>
<span class="x">        &lt;h1&gt;Search&lt;/h1&gt;</span>

<span class="x">        &lt;!-- VULNERABLE LINE: raw echo of user input --&gt;</span>
<span class="x">        &lt;!-- If q contains &lt;script&gt;... it will run in the visitor&#39;s browser. --&gt;</span>
<span class="x">        &lt;p&gt;You searched for: </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$q</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt; &lt;!-- VULNERABLE --&gt;</span>

<span class="x">        &lt;br&gt;</span>
<span class="x">        &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>Teaching note:</strong> open <code class="docutils literal notranslate"><span class="pre">page1_reflect.php?q=&lt;script&gt;alert('Hacked')&lt;/script&gt;</span></code> to see how an attacker-supplied <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> executes. The vulnerability comes from outputting unescaped input into an HTML context.</p>
</section>
<hr class="docutils" />
<section id="page1-reflect-prevent-php-reflected-xss-fixed">
<h2><code class="docutils literal notranslate"><span class="pre">page1_reflect_prevent.php</span></code> — reflected XSS <strong>fixed</strong><a class="headerlink" href="#page1-reflect-prevent-php-reflected-xss-fixed" title="Link to this heading">#</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// page1_reflect_prevent.php</span>
<span class="c1">// Fixed version of reflected XSS demo. Escape output with htmlspecialchars</span>
<span class="c1">// so any HTML tags supplied in the query string are rendered as text.</span>

<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="c1">// Use a small helper for clarity (context-aware escaping for HTML).</span>
<span class="k">function</span> <span class="nf">e</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ENT_QUOTES encodes both double and single quotes.</span>
    <span class="c1">// &#39;UTF-8&#39; ensures proper encoding for multibyte characters.</span>
    <span class="k">return</span> <span class="nb">htmlspecialchars</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span><span class="nv">$s</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="x">&lt;!doctype html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="x">    &lt;title&gt;Hacked (Reflect - Prevented)&lt;/title&gt;</span>
<span class="x">    &lt;style&gt;.div1 { width:50%; background:cornsilk; margin:50px auto; padding:1rem; }&lt;/style&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class=&quot;div1&quot;&gt;</span>
<span class="x">        &lt;h1&gt;Search&lt;/h1&gt;</span>

<span class="x">        &lt;!-- SAFE OUTPUT: any &lt; or &gt; in $q are converted to &amp;lt; &amp;gt; --&gt;</span>
<span class="x">        &lt;p&gt;You searched for: </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">e</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt; &lt;!-- NOT VULNERABLE --&gt;</span>

<span class="x">        &lt;br&gt;</span>
<span class="x">        &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>Teaching note:</strong> <code class="docutils literal notranslate"><span class="pre">htmlspecialchars()</span></code> is the appropriate escape for HTML body content. If you output into other contexts (e.g., attribute, JS, CSS, URL) you must use a different encoding or a trusted library for context-aware encoding.</p>
</section>
<hr class="docutils" />
<section id="stored-hacked-php-vulnerable-stored-xss-guestbook">
<h2><code class="docutils literal notranslate"><span class="pre">stored_hacked.php</span></code> — <strong>vulnerable</strong> stored XSS guestbook<a class="headerlink" href="#stored-hacked-php-vulnerable-stored-xss-guestbook" title="Link to this heading">#</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// stored_hacked.php</span>
<span class="c1">// Toy guestbook that demonstrates stored XSS by rendering session-stored messages</span>
<span class="c1">// without escaping them. DO NOT deploy this as-is.</span>

<span class="nb">session_start</span><span class="p">();</span>

<span class="c1">// Place a malicious demo message in session to simulate previously stored content.</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;script&gt;alert(&#39;hacked stored!&#39;)&lt;/script&gt;&quot;</span><span class="p">];</span>

<span class="c1">// Load messages for display.</span>
<span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>

<span class="c1">// If the user posts something, the code below intentionally follows your original</span>
<span class="c1">// request: keep the `if (!empty($_POST[&#39;msg&#39;]))` check exactly as provided.</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// NOTE: this block is intentionally left minimal to match the original demo.</span>
    <span class="c1">// In the vulnerable demo we would append raw values to the messages array.</span>
    <span class="c1">// For clarity we simply reload messages here (no safe write).</span>
    <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="x">    &lt;title&gt;Stored — Guestbook (Vulnerable)&lt;/title&gt;</span>
<span class="x">    &lt;style&gt;.div1 { width:50%; background:cornsilk; margin:50px auto; padding:1rem; }&lt;/style&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class=&quot;div1&quot;&gt;</span>
<span class="x">        &lt;h1&gt;Guestbook&lt;/h1&gt;</span>

<span class="x">        &lt;!-- Simple form to demonstrate posting --&gt;</span>
<span class="x">        &lt;form method=&quot;post&quot; action=&quot;&quot;&gt;</span>
<span class="x">            &lt;input name=&quot;msg&quot; placeholder=&quot;Say hi&quot; value=&quot;Hello&quot;&gt;</span>
<span class="x">            &lt;button&gt;POST&lt;/button&gt;</span>
<span class="x">        &lt;/form&gt;</span>

<span class="x">        &lt;ul&gt;</span>
<span class="x">            </span><span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$m</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
<span class="x">                &lt;!-- VULNERABLE: stored messages are printed raw, so a stored &lt;script&gt; will execute --&gt;</span>
<span class="x">                &lt;li&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$m</span> <span class="cp">?&gt;</span><span class="x">&lt;/li&gt; &lt;!-- VULNERABLE --&gt;</span>
<span class="x">            </span><span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="x">        &lt;/ul&gt;</span>

<span class="x">        &lt;br&gt;</span>
<span class="x">        &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>Teaching note:</strong> Stored XSS occurs when untrusted data is persisted (database, session, file) and later served to users without cleaning/escaping. The attack becomes more dangerous because many visitors might execute the injected script.</p>
</section>
<hr class="docutils" />
<section id="stored-hacked-prevent-php-stored-xss-prevented-sanitizing-on-output">
<h2><code class="docutils literal notranslate"><span class="pre">stored_hacked_prevent.php</span></code> — stored XSS <strong>prevented</strong> (sanitizing on output)<a class="headerlink" href="#stored-hacked-prevent-php-stored-xss-prevented-sanitizing-on-output" title="Link to this heading">#</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// stored_hacked_prevent.php</span>
<span class="c1">// Prevents stored XSS by escaping/sanitizing messages before output.</span>
<span class="c1">// Uses the same `if (!empty($_POST[&#39;msg&#39;]))` check as requested.</span>

<span class="nb">session_start</span><span class="p">();</span>

<span class="c1">// Demo initial message that simulates previously stored malicious content.</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;script&gt;alert(&#39;hacked stored!&#39;)&lt;/script&gt;&quot;</span><span class="p">];</span>

<span class="c1">// Retrieve messages array from session</span>
<span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>

<span class="c1">// Keep original check as requested (no substitution)</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// In a real app we would append the submitted message to the session or DB.</span>
    <span class="c1">// For the classroom demo we show the flow but avoid writing raw content.</span>
    <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * sanitize()</span>
<span class="sd"> * - trim() removes leading/trailing whitespace</span>
<span class="sd"> * - strip_tags() removes HTML/PHP tags</span>
<span class="sd"> * - htmlspecialchars() escapes remaining special characters for HTML output</span>
<span class="sd"> *</span>
<span class="sd"> * This function is defensive and simple — it&#39;s for demonstration and classroom use.</span>
<span class="sd"> * In production consider more context-aware measures (e.g., policies, CSP, output encoding libraries).</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">sanitize</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span><span class="nv">$value</span><span class="p">);</span>                       <span class="c1">// trim whitespace</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>                        <span class="c1">// remove HTML tags</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span> <span class="c1">// escape for HTML context</span>
    <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="x">    &lt;title&gt;Stored — Guestbook (Prevented)&lt;/title&gt;</span>
<span class="x">    &lt;style&gt;.div1 { width:50%; background:cornsilk; margin:50px auto; padding:1rem; }&lt;/style&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class=&quot;div1&quot;&gt;</span>
<span class="x">        &lt;h1&gt;Guestbook — Prevented&lt;/h1&gt;</span>

<span class="x">        &lt;form method=&quot;post&quot; action=&quot;&quot;&gt;</span>
<span class="x">            &lt;input name=&quot;msg&quot; placeholder=&quot;Say hi&quot; value=&quot;Hello&quot;&gt;</span>
<span class="x">            &lt;button&gt;POST&lt;/button&gt;</span>
<span class="x">        &lt;/form&gt;</span>

<span class="x">        &lt;ul&gt;</span>
<span class="x">            </span><span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$m</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
<span class="x">                &lt;!-- SAFE: sanitize() neutralizes script tags and encodes special chars --&gt;</span>
<span class="x">                &lt;li&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">sanitize</span><span class="p">(</span><span class="nv">$m</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/li&gt; &lt;!-- NOT VULNERABLE --&gt;</span>
<span class="x">            </span><span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="x">        &lt;/ul&gt;</span>

<span class="x">        &lt;br&gt;</span>
<span class="x">        &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>Teaching note:</strong> the safest approach is to <strong>escape on output</strong> for the context you are rendering into. Sanitizing on input can help (reduce stored attack surface), but <strong>escaping at output</strong> is the strongest, context-specific defense.</p>
</section>
<hr class="docutils" />
<section id="observations">
<h2>Observations<a class="headerlink" href="#observations" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Visit <code class="docutils literal notranslate"><span class="pre">page1_reflect.php?q=&lt;script&gt;alert('XSS')&lt;/script&gt;</span></code> and then <code class="docutils literal notranslate"><span class="pre">page1_reflect_prevent.php?q=&lt;script&gt;alert('XSS')&lt;/script&gt;</span></code> — compare behavior.</p></li>
<li><p>Visit <code class="docutils literal notranslate"><span class="pre">stored_hacked.php</span></code> and observe the alert from the session-stored message. Then load <code class="docutils literal notranslate"><span class="pre">stored_hacked_prevent.php</span></code> to see the sanitized result.</p></li>
<li><p>Discuss: what happens if you put <code class="docutils literal notranslate"><span class="pre">onerror=&quot;...&quot;</span></code> into an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> tag inside a message? (Context matters — attribute vs body.)</p></li>
<li><p>Discuss Content Security Policy (CSP) as a further mitigation, and why it’s complementary (not a substitute) to proper escaping.</p></li>
</ol>
<hr class="docutils" />
<section id="id1">
<h3>10/2025<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./wpref"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="xssDefendingAgainstXSS.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Defending Against Cross Site Scripting</p>
      </div>
    </a>
    <a class="right-next"
       href="xssContentSecurityPolicy.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Content Security Policy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#index-php-home-page-with-demo-links"><code class="docutils literal notranslate"><span class="pre">index.php</span></code> — home page with demo links</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page1-reflect-php-vulnerable-reflected-xss-don-t-use-in-production"><code class="docutils literal notranslate"><span class="pre">page1_reflect.php</span></code> — <strong>vulnerable</strong> reflected XSS (don’t use in production)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page1-reflect-prevent-php-reflected-xss-fixed"><code class="docutils literal notranslate"><span class="pre">page1_reflect_prevent.php</span></code> — reflected XSS <strong>fixed</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stored-hacked-php-vulnerable-stored-xss-guestbook"><code class="docutils literal notranslate"><span class="pre">stored_hacked.php</span></code> — <strong>vulnerable</strong> stored XSS guestbook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stored-hacked-prevent-php-stored-xss-prevented-sanitizing-on-output"><code class="docutils literal notranslate"><span class="pre">stored_hacked_prevent.php</span></code> — stored XSS <strong>prevented</strong> (sanitizing on output)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">10/2025</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By James Goudy
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024 By James Goudy.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>